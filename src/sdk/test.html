<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealthTrack SDK Test</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        #log { background: #f5f5f5; padding: 15px; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>HealthTrack SDK Test Page</h1>

    <div class="section">
        <h2>SDK Controls</h2>
        <button onclick="initSDK()">Initialize SDK</button>
        <button onclick="trackPageView()">Track Page View</button>
        <button onclick="trackCustomEvent()">Track Custom Event</button>
        <button onclick="trackConversion()">Track Conversion</button>
        <button onclick="flushEvents()">Flush Events</button>
    </div>

    <div class="section">
        <h2>Console Log</h2>
        <div id="log"></div>
    </div>

    <script src="dist/healthtrack.js"></script>
    <script>
        // Override console.log to capture SDK logs
        const logDiv = document.getElementById('log');
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;

        function addLog(type, ...args) {
            const msg = args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : a).join(' ');
            logDiv.innerHTML += `[${type}] ${msg}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        console.log = (...args) => { originalLog(...args); addLog('LOG', ...args); };
        console.warn = (...args) => { originalWarn(...args); addLog('WARN', ...args); };
        console.error = (...args) => { originalError(...args); addLog('ERROR', ...args); };

        function initSDK() {
            HealthTrack.init({
                apiKey: 'test_api_key_12345',
                serverUrl: '/api/v1/events',
                debug: true
            });
            addLog('INFO', 'SDK initialized with test API key');
        }

        function trackPageView() {
            HealthTrack.trackPageView({ custom_prop: 'test' });
            addLog('INFO', 'Page view tracked');
        }

        function trackCustomEvent() {
            HealthTrack.trackEvent('button_click', { button: 'test' });
            addLog('INFO', 'Custom event tracked');
        }

        function trackConversion() {
            HealthTrack.trackConversion('lead_form', 100, { source: 'test' });
            addLog('INFO', 'Conversion tracked');
        }

        function flushEvents() {
            HealthTrack.flush();
            addLog('INFO', 'Events flushed');
        }

        // Check if HealthTrack is available
        if (typeof HealthTrack !== 'undefined') {
            addLog('SUCCESS', 'HealthTrack SDK loaded successfully!');
            addLog('INFO', 'Available methods: init, trackPageView, trackEvent, trackConversion, identify, setConsent, flush');
        } else {
            addLog('ERROR', 'HealthTrack SDK not loaded!');
        }
    </script>
</body>
</html>
